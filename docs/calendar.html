<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é»„å†æŸ¥è¯¢ - æœˆå†è§†å›¾</title>
    <style>
        body { font-family: 'Microsoft YaHei', Arial, sans-serif; text-align: center; margin: 0; padding: 20px; background: #f8f9fa; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); display: flex; gap: 30px; }
        .calendar-container { flex: 1; }
        .today-panel { width: 300px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 16px; min-height: 400px; }
        .today-panel h3 { margin: 0 0 15px 0; font-size: 16px; text-align: center; }
        .today-detail { margin: 6px 0; padding: 6px; background: rgba(255,255,255,0.15); border-radius: 6px; font-size: 11px; line-height: 1.4; }
        .month { margin: 0; padding: 25px; border-radius: 15px; background: #ffffff; border: 1px solid #e1e8ed; }
        .month h3 { margin: 0 0 25px 0; color: #2c3e50; font-size: 24px; text-align: center; font-weight: 600; }
        .navigation { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .nav-btn { background: #007bff; color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.2s ease; }
        .nav-btn:hover { background: #0056b3; transform: translateY(-1px); }
        .days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
        .day { padding: 8px; text-align: center; border-radius: 8px; min-height: 50px; display: flex; flex-direction: column; justify-content: space-between; font-size: 11px; cursor: pointer; position: relative; transition: all 0.2s ease; background: #ffffff; border: 1px solid #dee2e6; }
        .day:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .header { background: #f8f9fa; font-weight: 600; color: #495057; }
        .today { background: #fff3cd; border: 2px solid #ffc107; font-weight: 700; font-size: 16px; }
        .festival { background: #d4edda; color: #155724; }
        .solar-term { background: #d1ecf1; color: #0c5460; }
        .lunar-date { font-size: 10px; color: #6c757d; margin-top: 1px; font-weight: 500; }
        .day-number { font-weight: 700; font-size: 16px; color: #212529; }
        .festival-text { font-size: 9px; margin-top: 1px; font-weight: 600; }
        .almanac-info { font-size: 8px; color: #adb5bd; margin-top: 1px; font-weight: 500; }
        .detail-popup { display: none; position: fixed; background: #ffffff; border: 1px solid #dee2e6; border-radius: 12px; padding: 12px; box-shadow: 0 8px 25px rgba(0,0,0,0.15); z-index: 9999; min-width: 250px; font-size: 11px; text-align: left; }
        .detail-popup::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid #ffffff;
        }

        .detail-popup.arrow-down::before {
            top: auto;
            bottom: -8px;
            border-top: 8px solid #ffffff;
            border-bottom: none;
        }
        .detail-title { font-weight: 700; margin-bottom: 10px; color: #212529; border-bottom: 1px solid #dee2e6; padding-bottom: 5px; font-size: 12px; text-align: center; }
        .detail-item { margin: 5px 0; line-height: 1.3; padding: 2px 0; }
        .detail-item strong { color: #495057; min-width: 50px; display: inline-block; font-weight: 600; }
        .auspicious { color: #ffffff; font-weight: 700; background: linear-gradient(45deg, #28a745, #20c997); padding: 2px 6px; border-radius: 4px; display: inline-block; margin-left: 4px; }
        .inauspicious { color: #ffffff; font-weight: 700; background: linear-gradient(45deg, #dc3545, #fd7e14); padding: 2px 6px; border-radius: 4px; display: inline-block; margin-left: 4px; }
        @media (max-width: 768px) {
            .container { flex-direction: column; padding: 20px; gap: 20px; }
            .today-panel { width: 100%; padding: 20px; min-height: 350px; }
            .today-detail { font-size: 10px; padding: 5px; }
            .day { min-height: 45px; font-size: 10px; padding: 6px; }
            .day-number { font-size: 14px; }
            .lunar-date { font-size: 9px; }
            .festival-text { font-size: 8px; }
            .almanac-info { font-size: 7px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="calendar-container">
            <h1 style="font-size: 28px; margin-bottom: 20px; color: #2c3e50; font-weight: 700;">ğŸŒ™ é»„å†æŸ¥è¯¢ - æœˆå†è§†å›¾</h1>
            <div style="margin: 15px 0; font-size: 12px; color: #6c757d; background: #f8f9fa; padding: 15px; border-radius: 10px;">
                <div style="margin-bottom: 10px; display: flex; justify-content: center; flex-wrap: wrap; gap: 15px;">
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <div style="width: 12px; height: 12px; background: #d4edda; border-radius: 3px;"></div>
                        <span>èŠ‚æ—¥</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <div style="width: 12px; height: 12px; background: #d1ecf1; border-radius: 3px;"></div>
                        <span>èŠ‚æ°”</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <div style="width: 12px; height: 12px; background: #fff3cd; border: 2px solid #ffc107; border-radius: 3px;"></div>
                        <span>ä»Šæ—¥</span>
                    </div>
                </div>
                <div style="text-align: center; font-weight: 500;">ğŸ’¡ ç‚¹å‡»ä»»æ„æ—¥æœŸå¯æŸ¥çœ‹è¯¦ç»†çš„é»„å†ä¿¡æ¯</div>
            </div>

            <div class="navigation">
                <button id="prev-month" class="nav-btn">â¬…ï¸ ä¸Šæœˆ</button>
                <h2 id="current-month-year" style="margin: 0; color: #2c3e50; font-size: 22px; font-weight: 700;"></h2>
                <button id="next-month" class="nav-btn">ä¸‹æœˆ â¡ï¸</button>
            </div>

            <div id="calendar" class="month">
                <!-- Calendar will be generated here -->
            </div>
        </div>

        <div class="today-panel">
            <h3>ğŸŒŸ ä»Šæ—¥é»„å†</h3>
            <div id="today-details">
                <!-- Today's almanac info will be shown here -->
            </div>
        </div>
    </div>

    <script>
        const monthNames = ['ä¸€æœˆ', 'äºŒæœˆ', 'ä¸‰æœˆ', 'å››æœˆ', 'äº”æœˆ', 'å…­æœˆ', 'ä¸ƒæœˆ', 'å…«æœˆ', 'ä¹æœˆ', 'åæœˆ', 'åä¸€æœˆ', 'åäºŒæœˆ'];
        const dayNames = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
        const lunarMonths = ['æ­£æœˆ', 'äºŒæœˆ', 'ä¸‰æœˆ', 'å››æœˆ', 'äº”æœˆ', 'å…­æœˆ', 'ä¸ƒæœˆ', 'å…«æœˆ', 'ä¹æœˆ', 'åæœˆ', 'å†¬æœˆ', 'è…Šæœˆ'];

        // Chinese festivals and holidays data
        const festivals = {
            '1-1': 'å…ƒæ—¦',
            '2-14': 'æƒ…äººèŠ‚',
            '3-8': 'å¦‡å¥³èŠ‚',
            '4-5': 'æ¸…æ˜èŠ‚',
            '5-1': 'åŠ³åŠ¨èŠ‚',
            '5-4': 'é’å¹´èŠ‚',
            '6-1': 'å„¿ç«¥èŠ‚',
            '7-1': 'å»ºå…šèŠ‚',
            '8-1': 'å»ºå†›èŠ‚',
            '9-10': 'æ•™å¸ˆèŠ‚',
            '10-1': 'å›½åº†èŠ‚',
            '12-25': 'åœ£è¯èŠ‚'
        };

        // Chinese traditional festivals (lunar dates)
        const lunarFestivals = {
            '1-1': 'æ˜¥èŠ‚',
            '1-15': 'å…ƒå®µèŠ‚',
            '5-5': 'ç«¯åˆèŠ‚',
            '8-15': 'ä¸­ç§‹èŠ‚',
            '9-9': 'é‡é˜³èŠ‚'
        };

        // Solar terms (èŠ‚æ°”) - approximate dates
        const solarTerms = {
            '1': 'å°å¯’', '2': 'å¤§å¯’', '3': 'ç«‹æ˜¥', '4': 'é›¨æ°´',
            '5': 'æƒŠè›°', '6': 'æ˜¥åˆ†', '7': 'æ¸…æ˜', '8': 'è°·é›¨',
            '9': 'ç«‹å¤', '10': 'å°æ»¡', '11': 'èŠ’ç§', '12': 'å¤è‡³',
            '13': 'å°æš‘', '14': 'å¤§æš‘', '15': 'ç«‹ç§‹', '16': 'å¤„æš‘',
            '17': 'ç™½éœ²', '18': 'ç§‹åˆ†', '19': 'å¯’éœ²', '20': 'éœœé™',
            '21': 'ç«‹å†¬', '22': 'å°é›ª', '23': 'å¤§é›ª', '24': 'å†¬è‡³'
        };

        // Chinese zodiac (ç”Ÿè‚–)
        const zodiacSigns = ['é¼ ', 'ç‰›', 'è™', 'å…”', 'é¾™', 'è›‡', 'é©¬', 'ç¾Š', 'çŒ´', 'é¸¡', 'ç‹—', 'çŒª'];

        // Western zodiac (æ˜Ÿåº§)
        const westernZodiac = [
            { name: 'æ‘©ç¾¯åº§', start: [12, 22], end: [1, 19] },
            { name: 'æ°´ç“¶åº§', start: [1, 20], end: [2, 18] },
            { name: 'åŒé±¼åº§', start: [2, 19], end: [3, 20] },
            { name: 'ç™½ç¾Šåº§', start: [3, 21], end: [4, 19] },
            { name: 'é‡‘ç‰›åº§', start: [4, 20], end: [5, 20] },
            { name: 'åŒå­åº§', start: [5, 21], end: [6, 21] },
            { name: 'å·¨èŸ¹åº§', start: [6, 22], end: [7, 22] },
            { name: 'ç‹®å­åº§', start: [7, 23], end: [8, 22] },
            { name: 'å¤„å¥³åº§', start: [8, 23], end: [9, 22] },
            { name: 'å¤©ç§¤åº§', start: [9, 23], end: [10, 23] },
            { name: 'å¤©èåº§', start: [10, 24], end: [11, 22] },
            { name: 'å°„æ‰‹åº§', start: [11, 23], end: [12, 21] }
        ];

        // Six Harmonies (å…­æ›œ)
        const sixHarmonies = ['å…ˆèƒœ', 'å‹å¼•', 'å…ˆè´Ÿ', 'ä½›ç­', 'å¤§å®‰', 'èµ¤å£'];

        // Twelve Deities (åäºŒç¥)
        const twelveDeities = ['å»º', 'é™¤', 'æ»¡', 'å¹³', 'å®š', 'æ‰§', 'ç ´', 'å±', 'æˆ', 'æ”¶', 'å¼€', 'é—­'];

        // Simplified lunar date calculation
        function getLunarDate(year, month, day) {
            const baseDate = new Date(1900, 0, 31);
            const currentDate = new Date(year, month, day);
            const daysDiff = Math.floor((currentDate - baseDate) / (1000 * 60 * 60 * 24));

            const lunarDay = (daysDiff % 30) + 1;
            const lunarMonth = ((daysDiff % 354) / 30) + 1;

            return {
                month: Math.floor(lunarMonth),
                day: lunarDay,
                monthName: lunarMonths[Math.floor(lunarMonth) - 1] || 'æœªçŸ¥',
                dayName: lunarDay === 1 ? 'åˆä¸€' : (lunarDay <= 10 ? `åˆ${lunarDay}` : lunarDay <= 20 ? `å${lunarDay - 10}` : lunarDay <= 30 ? `å»¿${lunarDay - 20}` : 'ä¸‰å')
            };
        }

        function getWesternZodiac(month, day) {
            for (let zodiac of westernZodiac) {
                const start = zodiac.start;
                const end = zodiac.end;

                if ((month === start[0] && day >= start[1]) || (month === end[0] && day <= end[1])) {
                    return zodiac.name;
                }
            }
            return westernZodiac[0].name;
        }

        function getZodiacSign(year) {
            return zodiacSigns[(year - 4) % 12];
        }

        function getSixHarmony(day) {
            return sixHarmonies[day % 6];
        }

        function getTwelveDeity(day) {
            return twelveDeities[day % 12];
        }

        function getSixHarmonyDescription(harmony) {
            const descriptions = {
                'å…ˆèƒœ': 'å®œå…ˆå‘åˆ¶äººï¼Œä¸»åŠ¨å‡ºå‡»',
                'å‹å¼•': 'å¿Œè¿œè¡Œï¼Œå®œä¼šå‹',
                'å…ˆè´Ÿ': 'ä¸å®œæ€¥èºï¼Œå®œå®ˆä¸å®œæ”»',
                'ä½›ç­': 'è¯¸äº‹ä¸å®œï¼Œå®œé™å…»',
                'å¤§å®‰': 'ä¸‡äº‹å¤§å‰ï¼Œå®œè¡Œå¤§äº‹',
                'èµ¤å£': 'å£èˆŒæ˜¯éï¼Œå®œä¿®èº«å…»æ€§'
            };
            return descriptions[harmony] || '';
        }

        function getTwelveDeityDescription(deity) {
            const descriptions = {
                'å»º': 'å®œå‡ºè¡Œã€åŠ¨åœŸã€ä¿®é€ ',
                'é™¤': 'å®œæ¸…é™¤ã€æ‰«é™¤ã€ç¥­ç¥€',
                'æ»¡': 'å®œå®´è¯·ã€å©šå«ã€äº¤æ˜“',
                'å¹³': 'å®œä¿®æ•´ã€æ±‚åŒ»ã€äº¤æ˜“',
                'å®š': 'å®œç¥­ç¥€ã€ç¥ˆç¦ã€è®¢å©š',
                'æ‰§': 'å®œæ•æ‰ã€æ•æ‰ã€æ•æ‰',
                'ç ´': 'å®œç ´åœŸã€ç ´å±‹ã€ç ´è´¢',
                'å±': 'å®œé«˜å±ã€å†’é™©ã€æ¢é™©',
                'æˆ': 'å®œæˆå°±ã€æˆåŠŸã€å®Œå·¥',
                'æ”¶': 'å®œæ”¶è·ã€æ”¶è—ã€èšè´¢',
                'å¼€': 'å®œå¼€å¯ã€æ–°å§‹ã€å¼€å¼ ',
                'é—­': 'å®œå…³é—­ã€ç»“æŸã€ä¼‘æ¯'
            };
            return descriptions[deity] || '';
        }

        function showAlmanacDetail(year, month, day, event) {
            // Hide any existing popups
            document.querySelectorAll('.detail-popup').forEach(popup => popup.style.display = 'none');

            const lunarDate = getLunarDate(year, month, day);
            const zodiac = getZodiacSign(year);
            const westernZodiacSign = getWesternZodiac(month + 1, day);
            const sixHarmony = getSixHarmony(day);
            const twelveDeity = getTwelveDeity(day);

            // Create popup element
            const popup = document.createElement('div');
            popup.className = 'detail-popup';
            popup.innerHTML = `
                <div class="detail-title">ğŸ“– ${year}å¹´${month + 1}æœˆ${day}æ—¥ è¯¦ç»†é»„å†</div>
                <div class="detail-item">ğŸ“… <strong>å…¬å†ï¼š</strong>${year}å¹´${month + 1}æœˆ${day}æ—¥</div>
                <div class="detail-item">ğŸŒ™ <strong>å†œå†ï¼š</strong>${lunarDate.monthName}${lunarDate.dayName}</div>
                <div class="detail-item">ğŸ‰ <strong>ç”Ÿè‚–ï¼š</strong>${zodiac}å¹´</div>
                <div class="detail-item">â­ <strong>æ˜Ÿåº§ï¼š</strong>${westernZodiacSign}</div>
                <div class="detail-item">ğŸ”® <strong>å…­æ›œï¼š</strong>${sixHarmony} - ${getSixHarmonyDescription(sixHarmony)}</div>
                <div class="detail-item">âš¡ <strong>åäºŒç¥ï¼š</strong>${twelveDeity} - ${getTwelveDeityDescription(twelveDeity)}</div>
                <div class="detail-item"><strong>å®œï¼š</strong><span class="auspicious">ç¥­ç¥€ã€ç¥ˆç¦ã€å‡ºè¡Œã€åŠ¨åœŸ</span></div>
                <div class="detail-item"><strong>å¿Œï¼š</strong><span class="inauspicious">è¯‰è®¼ã€äº‰æ–—ã€å«å¨¶</span></div>
                <div class="detail-item"><strong>æ—¶è¾°å‰å‡¶ï¼š</strong>å­æ—¶å‰ã€ä¸‘æ—¶å¹³ã€å¯…æ—¶å‡¶</div>
                <div class="detail-item"><strong>äº”è¡Œï¼š</strong>é‡‘æ—º åœŸç›¸</div>
                <div class="detail-item"><strong>å½­ç¥–ç™¾å¿Œï¼š</strong>å¿Œæ ½ç§ã€ä¿®å±‹</div>
            `;

            // Add popup to body and make it visible to get accurate dimensions
            document.body.appendChild(popup);
            popup.style.display = 'block';

            // Calculate optimal position
            const dayRect = event.currentTarget.getBoundingClientRect();
            const popupRect = popup.getBoundingClientRect();
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;

            // Determine if popup should show above or below the clicked date
            // Use a lower threshold to prefer showing popup below more often
            const dayCenterY = dayRect.top + (dayRect.height / 2);
            const viewportCenterY = viewportHeight * 0.4; // Lower threshold to prefer bottom
            const showAbove = dayCenterY > viewportCenterY;

            let left = dayRect.left + (dayRect.width / 2) - (popupRect.width / 2);
            let top;

            if (showAbove) {
                // Show popup above the date
                top = dayRect.top - popupRect.height - 10;
                // Adjust arrow to point down
                popup.classList.add('arrow-down');
            } else {
                // Show popup below the date
                top = dayRect.bottom + 10;
                // Adjust arrow to point up
                popup.classList.remove('arrow-down');
            }

            // Adjust horizontal position if popup goes off screen
            if (left < 10) {
                left = 10;
            } else if (left + popupRect.width > viewportWidth - 10) {
                left = viewportWidth - popupRect.width - 10;
            }

            // Adjust vertical position if popup goes off screen
            if (showAbove) {
                if (top < 10) {
                    top = dayRect.bottom + 10;
                    popup.classList.remove('arrow-down');
                }
            } else {
                if (top + popupRect.height > viewportHeight - 10) {
                    top = dayRect.top - popupRect.height - 10;
                    popup.classList.add('arrow-down');
                }
            }

            popup.style.left = left + 'px';
            popup.style.top = top + 'px';

            // Hide popup when clicking elsewhere
            const clickedDay = event.currentTarget;
            document.addEventListener('click', function hidePopup(e) {
                if (!popup.contains(e.target) && !clickedDay.contains(e.target)) {
                    popup.style.display = 'none';
                    document.body.removeChild(popup);
                    document.removeEventListener('click', hidePopup);
                }
            });
        }

        let currentDate = new Date();

        function generateCalendar(year, month) {
            const calendar = document.getElementById('calendar');
            calendar.innerHTML = '';

            // Update month/year display
            document.getElementById('current-month-year').textContent = `${year}å¹´ ${monthNames[month]}`;

            // Create days grid
            const daysDiv = document.createElement('div');
            daysDiv.className = 'days';

            // Add day headers
            dayNames.forEach(day => {
                const header = document.createElement('div');
                header.className = 'day header';
                header.textContent = day;
                daysDiv.appendChild(header);
            });

            // Calculate first day of the month
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            // Add days from previous month
            const prevMonth = month === 0 ? 11 : month - 1;
            const prevYear = month === 0 ? year - 1 : year;
            const daysInPrevMonth = new Date(prevYear, prevMonth + 1, 0).getDate();

            for (let i = 0; i < firstDay; i++) {
                const prevDay = daysInPrevMonth - firstDay + i + 1;
                const day = document.createElement('div');
                day.className = 'day prev-month';

                // Get lunar date for previous month
                const lunarDate = getLunarDate(prevYear, prevMonth, prevDay);

                // Check for festivals and solar terms
                const dateKey = `${prevMonth + 1}-${prevDay}`;
                const festival = festivals[dateKey];
                const lunarFestival = lunarFestivals[`${lunarDate.month}-${lunarDate.day}`];
                const solarTerm = getSolarTerm(prevYear, prevMonth + 1, prevDay);

                // Get almanac info
                const sixHarmony = getSixHarmony(prevDay);
                const twelveDeity = getTwelveDeity(prevDay);

                // Create day content
                let dayContent = `<div class="day-number">${prevDay}</div>`;
                dayContent += `<div class="lunar-date">${lunarDate.dayName}</div>`;

                // Add festival or solar term info
                if (festival) {
                    dayContent += `<div class="festival-text">${festival}</div>`;
                    day.classList.add('festival');
                } else if (lunarFestival) {
                    dayContent += `<div class="festival-text">${lunarFestival}</div>`;
                    day.classList.add('festival');
                } else if (solarTerm) {
                    dayContent += `<div class="festival-text">${solarTerm}</div>`;
                    day.classList.add('solar-term');
                } else {
                    // Show almanac info for regular days
                    dayContent += `<div class="almanac-info">${sixHarmony} ${twelveDeity}</div>`;
                }

                day.innerHTML = dayContent;
                day.style.opacity = '0.5';
                day.style.backgroundColor = '#f8f9fa';
                day.style.color = '#6c757d';

                // Add click event for detailed almanac info
                day.addEventListener('click', (event) => {
                    event.stopPropagation();
                    showAlmanacDetail(prevYear, prevMonth, prevDay, event);
                });

                daysDiv.appendChild(day);
            }

            // Add days of the month
            for (let d = 1; d <= daysInMonth; d++) {
                const day = document.createElement('div');
                day.className = 'day';

                // Get lunar date
                const lunarDate = getLunarDate(year, month, d);

                // Check for festivals and solar terms
                const dateKey = `${month + 1}-${d}`;
                const festival = festivals[dateKey];
                const lunarFestival = lunarFestivals[`${lunarDate.month}-${lunarDate.day}`];
                const solarTerm = getSolarTerm(year, month + 1, d);

                // Get almanac info
                const sixHarmony = getSixHarmony(d);
                const twelveDeity = getTwelveDeity(d);

                // Create day content
                let dayContent = `<div class="day-number">${d}</div>`;
                dayContent += `<div class="lunar-date">${lunarDate.dayName}</div>`;

                // Add festival or solar term info
                if (festival) {
                    dayContent += `<div class="festival-text">${festival}</div>`;
                    day.classList.add('festival');
                } else if (lunarFestival) {
                    dayContent += `<div class="festival-text">${lunarFestival}</div>`;
                    day.classList.add('festival');
                } else if (solarTerm) {
                    dayContent += `<div class="festival-text">${solarTerm}</div>`;
                    day.classList.add('solar-term');
                } else {
                    // Show almanac info for regular days
                    dayContent += `<div class="almanac-info">${sixHarmony} ${twelveDeity}</div>`;
                }

                day.innerHTML = dayContent;

                // Highlight today
                const today = new Date();
                if (year === today.getFullYear() && month === today.getMonth() && d === today.getDate()) {
                    day.classList.add('today');
                }

                // Add click event for detailed almanac info
                day.addEventListener('click', (event) => {
                    event.stopPropagation();
                    showAlmanacDetail(year, month, d, event);
                });

                daysDiv.appendChild(day);
            }

            // Add days from next month to fill the grid
            const totalCells = 42; // 6 rows * 7 days
            const currentCells = firstDay + daysInMonth;
            const remainingCells = totalCells - currentCells;

            // Calculate next month and year
            const nextMonth = month === 11 ? 0 : month + 1;
            const nextYear = month === 11 ? year + 1 : year;

            for (let i = 1; i <= remainingCells; i++) {
                const day = document.createElement('div');
                day.className = 'day next-month';

                // Get lunar date for next month
                const lunarDate = getLunarDate(nextYear, nextMonth, i);

                // Check for festivals and solar terms
                const dateKey = `${nextMonth + 1}-${i}`;
                const festival = festivals[dateKey];
                const lunarFestival = lunarFestivals[`${lunarDate.month}-${lunarDate.day}`];
                const solarTerm = getSolarTerm(nextYear, nextMonth + 1, i);

                // Get almanac info
                const sixHarmony = getSixHarmony(i);
                const twelveDeity = getTwelveDeity(i);

                // Create day content
                let dayContent = `<div class="day-number">${i}</div>`;
                dayContent += `<div class="lunar-date">${lunarDate.dayName}</div>`;

                // Add festival or solar term info
                if (festival) {
                    dayContent += `<div class="festival-text">${festival}</div>`;
                    day.classList.add('festival');
                } else if (lunarFestival) {
                    dayContent += `<div class="festival-text">${lunarFestival}</div>`;
                    day.classList.add('festival');
                } else if (solarTerm) {
                    dayContent += `<div class="festival-text">${solarTerm}</div>`;
                    day.classList.add('solar-term');
                } else {
                    // Show almanac info for regular days
                    dayContent += `<div class="almanac-info">${sixHarmony} ${twelveDeity}</div>`;
                }

                day.innerHTML = dayContent;
                day.style.opacity = '0.5';
                day.style.backgroundColor = '#f8f9fa';
                day.style.color = '#6c757d';

                // Add click event for detailed almanac info
                day.addEventListener('click', (event) => {
                    event.stopPropagation();
                    showAlmanacDetail(nextYear, nextMonth, i, event);
                });

                daysDiv.appendChild(day);
            }

            calendar.appendChild(daysDiv);
        }

        function getSolarTerm(year, month, day) {
            // Simplified solar term calculation
            const solarTermDates = {
                1: [5, 6], 2: [4, 5], 3: [5, 6], 4: [20, 21], 5: [5, 6], 6: [21, 22], 7: [5, 6], 8: [22, 23],
                9: [7, 8], 10: [23, 24], 11: [7, 8], 12: [21, 22], 13: [7, 8], 14: [22, 23], 15: [7, 8], 16: [22, 23],
                17: [8, 9], 18: [23, 24], 19: [8, 9], 20: [22, 23], 21: [7, 8], 22: [21, 22], 23: [6, 7], 24: [21, 22]
            };

            const termIndex = (month - 1) * 2 + (day <= 15 ? 1 : 2);
            const termDates = solarTermDates[termIndex];

            if (termDates && (day === termDates[0] || day === termDates[1])) {
                return solarTerms[termIndex];
            }
            return null;
        }

        function showTodayInfo() {
            const today = new Date();
            const year = today.getFullYear();
            const month = today.getMonth();
            const day = today.getDate();

            const lunarDate = getLunarDate(year, month, day);
            const zodiac = getZodiacSign(year);
            const westernZodiacSign = getWesternZodiac(month + 1, day);
            const sixHarmony = getSixHarmony(day);
            const twelveDeity = getTwelveDeity(day);
            const sixHarmonyDesc = getSixHarmonyDescription(sixHarmony);
            const twelveDeityDesc = getTwelveDeityDescription(twelveDeity);

            const todayDetails = document.getElementById('today-details');

            todayDetails.innerHTML = `
                <div class="today-detail">ğŸ“… <strong>æ—¥æœŸï¼š</strong>${year}å¹´${month + 1}æœˆ${day}æ—¥</div>
                <div class="today-detail">ğŸŒ™ <strong>å†œå†ï¼š</strong>${lunarDate.monthName}${lunarDate.dayName}</div>
                <div class="today-detail">ğŸ‰ <strong>ç”Ÿè‚–ï¼š</strong>${zodiac}å¹´</div>
                <div class="today-detail">â­ <strong>æ˜Ÿåº§ï¼š</strong>${westernZodiacSign}</div>
                <div class="today-detail">ğŸ”® <strong>å…­æ›œï¼š</strong>${sixHarmony} - ${sixHarmonyDesc}</div>
                <div class="today-detail">âš¡ <strong>åäºŒç¥ï¼š</strong>${twelveDeity} - ${twelveDeityDesc}</div>
                <div class="today-detail"><strong>å®œï¼š</strong><span class="auspicious">ç¥­ç¥€ã€ç¥ˆç¦ã€å‡ºè¡Œã€åŠ¨åœŸ</span></div>
                <div class="today-detail"><strong>å¿Œï¼š</strong><span class="inauspicious">è¯‰è®¼ã€äº‰æ–—ã€å«å¨¶</span></div>
                <div class="today-detail"><strong>æ—¶è¾°å‰å‡¶ï¼š</strong>å­æ—¶å‰ã€ä¸‘æ—¶å¹³ã€å¯…æ—¶å‡¶</div>
                <div class="today-detail"><strong>äº”è¡Œï¼š</strong>é‡‘æ—º åœŸç›¸</div>
                <div class="today-detail"><strong>å½­ç¥–ç™¾å¿Œï¼š</strong>å¿Œæ ½ç§ã€ä¿®å±‹</div>
            `;
        }

        function navigateMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
            showTodayInfo();
        }

        // Initialize
        document.getElementById('prev-month').addEventListener('click', () => navigateMonth(-1));
        document.getElementById('next-month').addEventListener('click', () => navigateMonth(1));

        // Start with current month
        generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
        showTodayInfo();
    </script>
</body>
</html>